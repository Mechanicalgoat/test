<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒªãƒãƒ¼ã‚¹ãƒ†ãƒˆãƒªã‚¹ ãƒ‡ãƒãƒƒã‚°ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            padding: 20px;
            background: #222;
            color: #fff;
        }
        h1 {
            color: #60a5fa;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #444;
            border-radius: 5px;
        }
        .status {
            margin: 10px 0;
            padding: 10px;
            border-radius: 3px;
        }
        .success {
            background: #10b981;
            color: white;
        }
        .error {
            background: #ef4444;
            color: white;
        }
        .info {
            background: #3b82f6;
            color: white;
        }
        button {
            margin: 5px;
            padding: 10px 20px;
            background: #60a5fa;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background: #3b82f6;
        }
        #test-board {
            border: 2px solid #60a5fa;
            margin: 10px 0;
        }
        #log {
            background: #111;
            padding: 10px;
            border-radius: 5px;
            max-height: 300px;
            overflow-y: auto;
            font-size: 12px;
        }
        .log-entry {
            margin: 2px 0;
        }
        .grid-display {
            font-family: monospace;
            white-space: pre;
            background: #000;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª ãƒªãƒãƒ¼ã‚¹ãƒ†ãƒˆãƒªã‚¹ ãƒ‡ãƒãƒƒã‚°ãƒ†ã‚¹ãƒˆ</h1>
    
    <div class="test-section">
        <h2>1. ãƒ©ã‚¤ãƒ³æ¶ˆå»ãƒ†ã‚¹ãƒˆ</h2>
        <button onclick="testLineClear()">ãƒ©ã‚¤ãƒ³æ¶ˆå»ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
        <button onclick="testMultipleLines()">è¤‡æ•°ãƒ©ã‚¤ãƒ³æ¶ˆå»ãƒ†ã‚¹ãƒˆ</button>
        <div id="line-test-result"></div>
    </div>
    
    <div class="test-section">
        <h2>2. ã‚²ãƒ¼ãƒ ã‚¯ãƒªã‚¢åˆ¤å®šãƒ†ã‚¹ãƒˆ</h2>
        <button onclick="testGameClear()">ã‚²ãƒ¼ãƒ ã‚¯ãƒªã‚¢åˆ¤å®šãƒ†ã‚¹ãƒˆ</button>
        <button onclick="testTopRowsDetection()">ä¸Šéƒ¨3è¡Œæ¤œå‡ºãƒ†ã‚¹ãƒˆ</button>
        <div id="clear-test-result"></div>
    </div>
    
    <div class="test-section">
        <h2>3. å®Ÿéš›ã®ã‚²ãƒ¼ãƒ ãƒ†ã‚¹ãƒˆ</h2>
        <canvas id="test-board" width="300" height="600"></canvas>
        <div>
            <button onclick="startTestGame()">ãƒ†ã‚¹ãƒˆã‚²ãƒ¼ãƒ é–‹å§‹</button>
            <button onclick="sendTestPiece()">ãƒ†ã‚¹ãƒˆãƒ”ãƒ¼ã‚¹é€ä¿¡</button>
            <button onclick="fillBottomRows()">ä¸‹éƒ¨ã‚’åŸ‹ã‚ã‚‹</button>
            <button onclick="fillTopRows()">ä¸Šéƒ¨3è¡Œã«é…ç½®</button>
            <button onclick="createCompleteLine()">å®Œæˆãƒ©ã‚¤ãƒ³ä½œæˆ</button>
        </div>
        <div id="game-status"></div>
    </div>
    
    <div class="test-section">
        <h2>4. ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°</h2>
        <div id="log"></div>
    </div>
    
    <div class="test-section">
        <h2>5. ãƒœãƒ¼ãƒ‰çŠ¶æ…‹è¡¨ç¤º</h2>
        <div id="board-display" class="grid-display"></div>
    </div>

    <script>
        // ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°é–¢æ•°
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            const time = new Date().toTimeString().split(' ')[0];
            entry.innerHTML = `<span style="color: ${type === 'error' ? '#ef4444' : type === 'success' ? '#10b981' : '#60a5fa'}">[${time}]</span> ${message}`;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }

        // ãƒ†ã‚¹ãƒˆç”¨ãƒœãƒ¼ãƒ‰ä½œæˆ
        function createTestBoard(width = 10, height = 20) {
            return Array(height).fill().map(() => Array(width).fill(0));
        }

        // ãƒœãƒ¼ãƒ‰è¡¨ç¤º
        function displayBoard(board) {
            const display = document.getElementById('board-display');
            let text = '   0 1 2 3 4 5 6 7 8 9\n';
            text += '  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n';
            for (let y = 0; y < board.length; y++) {
                text += (y < 10 ? ' ' : '') + y + 'â”‚';
                for (let x = 0; x < board[y].length; x++) {
                    text += board[y][x] === 0 ? '  ' : 'â–  ';
                }
                text += 'â”‚' + (y < 3 ? ' â† Top' : '') + '\n';
            }
            text += '  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n';
            display.textContent = text;
        }

        // 1. ãƒ©ã‚¤ãƒ³æ¶ˆå»ãƒ†ã‚¹ãƒˆ
        function testLineClear() {
            log('=== ãƒ©ã‚¤ãƒ³æ¶ˆå»ãƒ†ã‚¹ãƒˆé–‹å§‹ ===', 'info');
            const board = createTestBoard();
            
            // 19è¡Œç›®ï¼ˆæœ€ä¸‹æ®µï¼‰ã‚’å®Œå…¨ã«åŸ‹ã‚ã‚‹
            for (let x = 0; x < 10; x++) {
                board[19][x] = 'T';
            }
            
            displayBoard(board);
            
            // å®Œæˆãƒ©ã‚¤ãƒ³æ¤œå‡º
            const completedLines = [];
            for (let y = 0; y < board.length; y++) {
                if (board[y].every(cell => cell !== 0)) {
                    completedLines.push(y);
                }
            }
            
            if (completedLines.length > 0) {
                log(`å®Œæˆãƒ©ã‚¤ãƒ³æ¤œå‡º: è¡Œ ${completedLines.join(', ')}`, 'success');
                
                // ãƒ©ã‚¤ãƒ³å‰Šé™¤
                completedLines.sort((a, b) => b - a);
                for (const lineIndex of completedLines) {
                    board.splice(lineIndex, 1);
                    board.unshift(Array(10).fill(0));
                }
                
                log('ãƒ©ã‚¤ãƒ³æ¶ˆå»å®Œäº†', 'success');
                displayBoard(board);
                
                document.getElementById('line-test-result').innerHTML = 
                    '<div class="status success">âœ… ãƒ©ã‚¤ãƒ³æ¶ˆå»ãƒ†ã‚¹ãƒˆæˆåŠŸ</div>';
            } else {
                log('å®Œæˆãƒ©ã‚¤ãƒ³ãŒæ¤œå‡ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ', 'error');
                document.getElementById('line-test-result').innerHTML = 
                    '<div class="status error">âŒ ãƒ©ã‚¤ãƒ³æ¶ˆå»ãƒ†ã‚¹ãƒˆå¤±æ•—</div>';
            }
        }

        // è¤‡æ•°ãƒ©ã‚¤ãƒ³æ¶ˆå»ãƒ†ã‚¹ãƒˆ
        function testMultipleLines() {
            log('=== è¤‡æ•°ãƒ©ã‚¤ãƒ³æ¶ˆå»ãƒ†ã‚¹ãƒˆé–‹å§‹ ===', 'info');
            const board = createTestBoard();
            
            // 17, 18, 19è¡Œç›®ã‚’åŸ‹ã‚ã‚‹
            for (let y = 17; y < 20; y++) {
                for (let x = 0; x < 10; x++) {
                    board[y][x] = 'I';
                }
            }
            
            displayBoard(board);
            
            // å®Œæˆãƒ©ã‚¤ãƒ³æ¤œå‡º
            const completedLines = [];
            for (let y = 0; y < board.length; y++) {
                if (board[y].every(cell => cell !== 0)) {
                    completedLines.push(y);
                }
            }
            
            log(`å®Œæˆãƒ©ã‚¤ãƒ³æ¤œå‡º: ${completedLines.length}è¡Œ`, 'info');
            
            if (completedLines.length === 3) {
                // ãƒ©ã‚¤ãƒ³å‰Šé™¤
                completedLines.sort((a, b) => b - a);
                for (const lineIndex of completedLines) {
                    board.splice(lineIndex, 1);
                    board.unshift(Array(10).fill(0));
                }
                
                log('3è¡ŒåŒæ™‚æ¶ˆå»æˆåŠŸ', 'success');
                displayBoard(board);
                
                document.getElementById('line-test-result').innerHTML = 
                    '<div class="status success">âœ… è¤‡æ•°ãƒ©ã‚¤ãƒ³æ¶ˆå»ãƒ†ã‚¹ãƒˆæˆåŠŸ</div>';
            } else {
                log(`ã‚¨ãƒ©ãƒ¼: ${completedLines.length}è¡Œã—ã‹æ¤œå‡ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ`, 'error');
                document.getElementById('line-test-result').innerHTML = 
                    '<div class="status error">âŒ è¤‡æ•°ãƒ©ã‚¤ãƒ³æ¶ˆå»ãƒ†ã‚¹ãƒˆå¤±æ•—</div>';
            }
        }

        // 2. ã‚²ãƒ¼ãƒ ã‚¯ãƒªã‚¢åˆ¤å®šãƒ†ã‚¹ãƒˆ
        function testGameClear() {
            log('=== ã‚²ãƒ¼ãƒ ã‚¯ãƒªã‚¢åˆ¤å®šãƒ†ã‚¹ãƒˆé–‹å§‹ ===', 'info');
            const board = createTestBoard();
            
            // ä¸Šéƒ¨3è¡Œç›®ï¼ˆindex=2ï¼‰ã«1ã¤ãƒ–ãƒ­ãƒƒã‚¯ã‚’é…ç½®
            board[2][5] = 'O';
            
            displayBoard(board);
            
            // ä¸Šéƒ¨3è¡Œã«ãƒ–ãƒ­ãƒƒã‚¯ãŒã‚ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
            let hasBlocksInTopRows = false;
            for (let y = 0; y < 3; y++) {
                for (let x = 0; x < 10; x++) {
                    if (board[y][x] !== 0) {
                        hasBlocksInTopRows = true;
                        log(`ãƒ–ãƒ­ãƒƒã‚¯æ¤œå‡º: è¡Œ${y}, åˆ—${x}`, 'info');
                        break;
                    }
                }
                if (hasBlocksInTopRows) break;
            }
            
            if (hasBlocksInTopRows) {
                log('ã‚²ãƒ¼ãƒ ã‚¯ãƒªã‚¢æ¡ä»¶é”æˆï¼', 'success');
                document.getElementById('clear-test-result').innerHTML = 
                    '<div class="status success">âœ… ã‚²ãƒ¼ãƒ ã‚¯ãƒªã‚¢åˆ¤å®šãƒ†ã‚¹ãƒˆæˆåŠŸ</div>';
            } else {
                log('ã‚²ãƒ¼ãƒ ã‚¯ãƒªã‚¢æ¡ä»¶æœªé”æˆ', 'error');
                document.getElementById('clear-test-result').innerHTML = 
                    '<div class="status error">âŒ ã‚²ãƒ¼ãƒ ã‚¯ãƒªã‚¢åˆ¤å®šãƒ†ã‚¹ãƒˆå¤±æ•—</div>';
            }
        }

        // ä¸Šéƒ¨3è¡Œæ¤œå‡ºãƒ†ã‚¹ãƒˆ
        function testTopRowsDetection() {
            log('=== ä¸Šéƒ¨3è¡Œæ¤œå‡ºãƒ†ã‚¹ãƒˆé–‹å§‹ ===', 'info');
            const board = createTestBoard();
            
            // ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹
            const testCases = [
                { row: 0, expected: true, desc: '1è¡Œç›®ï¼ˆæœ€ä¸Šæ®µï¼‰' },
                { row: 1, expected: true, desc: '2è¡Œç›®' },
                { row: 2, expected: true, desc: '3è¡Œç›®' },
                { row: 3, expected: false, desc: '4è¡Œç›®ï¼ˆç¯„å›²å¤–ï¼‰' },
            ];
            
            let allPassed = true;
            
            for (const test of testCases) {
                // ãƒœãƒ¼ãƒ‰ã‚’ã‚¯ãƒªã‚¢
                for (let y = 0; y < board.length; y++) {
                    for (let x = 0; x < board[y].length; x++) {
                        board[y][x] = 0;
                    }
                }
                
                // æŒ‡å®šè¡Œã«ãƒ–ãƒ­ãƒƒã‚¯é…ç½®
                board[test.row][5] = 'T';
                
                // ãƒã‚§ãƒƒã‚¯
                let detected = false;
                for (let y = 0; y < 3; y++) {
                    if (board[y].some(cell => cell !== 0)) {
                        detected = true;
                        break;
                    }
                }
                
                if (detected === test.expected) {
                    log(`âœ… ${test.desc}: æ­£å¸¸æ¤œå‡º`, 'success');
                } else {
                    log(`âŒ ${test.desc}: æ¤œå‡ºå¤±æ•—`, 'error');
                    allPassed = false;
                }
            }
            
            if (allPassed) {
                document.getElementById('clear-test-result').innerHTML = 
                    '<div class="status success">âœ… ä¸Šéƒ¨3è¡Œæ¤œå‡ºãƒ†ã‚¹ãƒˆå…¨ã¦æˆåŠŸ</div>';
            } else {
                document.getElementById('clear-test-result').innerHTML = 
                    '<div class="status error">âŒ ä¸Šéƒ¨3è¡Œæ¤œå‡ºãƒ†ã‚¹ãƒˆã«å¤±æ•—</div>';
            }
        }

        // åˆæœŸåŒ–
        log('ãƒ‡ãƒãƒƒã‚°ãƒ†ã‚¹ãƒˆã‚·ã‚¹ãƒ†ãƒ èµ·å‹•', 'info');
        log('å„ãƒ†ã‚¹ãƒˆãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦å‹•ä½œç¢ºèªã—ã¦ãã ã•ã„', 'info');
    </script>
</body>
</html>