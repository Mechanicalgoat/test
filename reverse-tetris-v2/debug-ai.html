<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI ãƒ‡ãƒãƒƒã‚° - ãƒªãƒãƒ¼ã‚¹ãƒ†ãƒˆãƒªã‚¹</title>
    <style>
        body { 
            font-family: monospace; 
            padding: 20px; 
            background: #111; 
            color: #fff; 
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #444;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.05);
        }
        pre {
            background: #000;
            padding: 10px;
            border-radius: 3px;
            overflow-x: auto;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            background: #333;
            color: #fff;
            border: 1px solid #666;
            border-radius: 3px;
            cursor: pointer;
        }
        button:hover { background: #444; }
        .success { color: #4ade80; }
        .error { color: #f87171; }
        .warning { color: #facc15; }
    </style>
</head>
<body>
    <h1>ğŸ”§ AI ã‚¨ãƒ³ã‚¸ãƒ³ ãƒ‡ãƒãƒƒã‚°ãƒ„ãƒ¼ãƒ«</h1>
    
    <div class="test-section">
        <h2>AI ã‚¨ãƒ³ã‚¸ãƒ³ã®å‹•ä½œç¢ºèª</h2>
        <button onclick="testAILoading()">AI èª­ã¿è¾¼ã¿ç¢ºèª</button>
        <button onclick="testAIPlacement()">AI é…ç½®ãƒ†ã‚¹ãƒˆ</button>
        <button onclick="testAllPieces()">å…¨ãƒ”ãƒ¼ã‚¹é…ç½®ãƒ†ã‚¹ãƒˆ</button>
        <pre id="ai-test-output"></pre>
    </div>

    <div class="test-section">
        <h2>ã‚²ãƒ¼ãƒ ã‚¨ãƒ³ã‚¸ãƒ³é€£æºãƒ†ã‚¹ãƒˆ</h2>
        <button onclick="testGameEngineAI()">ã‚²ãƒ¼ãƒ ã‚¨ãƒ³ã‚¸ãƒ³ã¨AIé€£æº</button>
        <button onclick="simulateGamePlay()">ã‚²ãƒ¼ãƒ å‹•ä½œã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ</button>
        <pre id="game-test-output"></pre>
    </div>

    <script src="game-engine.js"></script>
    <script src="ai-engine.js"></script>
    <script src="main.js"></script>
    
    <script>
        function log(message, type = 'info') {
            const output = document.getElementById('ai-test-output');
            const color = type === 'error' ? '#f87171' : 
                         type === 'success' ? '#4ade80' : 
                         type === 'warning' ? '#facc15' : '#fff';
            output.innerHTML += `<span style="color: ${color}">${message}</span>\n`;
            console.log(message);
        }

        function logGame(message, type = 'info') {
            const output = document.getElementById('game-test-output');
            const color = type === 'error' ? '#f87171' : 
                         type === 'success' ? '#4ade80' : 
                         type === 'warning' ? '#facc15' : '#fff';
            output.innerHTML += `<span style="color: ${color}">${message}</span>\n`;
            console.log(message);
        }

        function testAILoading() {
            document.getElementById('ai-test-output').innerHTML = '';
            log('=== AI ã‚¨ãƒ³ã‚¸ãƒ³èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ ===', 'info');
            
            try {
                if (typeof window.aiEngine === 'undefined') {
                    log('âŒ AI ã‚¨ãƒ³ã‚¸ãƒ³ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“', 'error');
                    return;
                }
                
                log('âœ… AI ã‚¨ãƒ³ã‚¸ãƒ³ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå­˜åœ¨ç¢ºèª', 'success');
                log(`AI ã‚¨ãƒ³ã‚¸ãƒ³ã‚¿ã‚¤ãƒ—: ${typeof window.aiEngine}`, 'info');
                log(`AI ã‚¨ãƒ³ã‚¸ãƒ³ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ãƒ¼: ${window.aiEngine.constructor.name}`, 'info');
                
                // ãƒ¡ã‚½ãƒƒãƒ‰ç¢ºèª
                const methods = ['findBestPlacement', 'rotateShape', 'evaluateGrid'];
                methods.forEach(method => {
                    if (typeof window.aiEngine[method] === 'function') {
                        log(`âœ… ${method} ãƒ¡ã‚½ãƒƒãƒ‰å­˜åœ¨`, 'success');
                    } else {
                        log(`âŒ ${method} ãƒ¡ã‚½ãƒƒãƒ‰ä¸å­˜åœ¨`, 'error');
                    }
                });
                
                // é›£æ˜“åº¦ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ç¢ºèª
                if (window.aiEngine.difficultyParams) {
                    log('âœ… é›£æ˜“åº¦ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å­˜åœ¨:', 'success');
                    log(JSON.stringify(window.aiEngine.difficultyParams, null, 2), 'info');
                } else {
                    log('âŒ é›£æ˜“åº¦ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä¸å­˜åœ¨', 'error');
                }
                
            } catch (error) {
                log(`âŒ AI ã‚¨ãƒ³ã‚¸ãƒ³èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        function testAIPlacement() {
            log('\n=== AI é…ç½®ãƒ†ã‚¹ãƒˆ ===', 'info');
            
            try {
                const testGrid = Array(20).fill().map(() => Array(10).fill(0));
                const testShape = [[1,1,1,1]]; // I-piece
                
                log('ãƒ†ã‚¹ãƒˆç”¨ã‚°ãƒªãƒƒãƒ‰ã¨ã‚·ã‚§ã‚¤ãƒ—ä½œæˆå®Œäº†', 'info');
                log(`ã‚°ãƒªãƒƒãƒ‰ã‚µã‚¤ã‚º: ${testGrid.length} x ${testGrid[0].length}`, 'info');
                log(`ãƒ†ã‚¹ãƒˆã‚·ã‚§ã‚¤ãƒ—: ${JSON.stringify(testShape)}`, 'info');
                
                const placement = window.aiEngine.findBestPlacement(testGrid, testShape, 'normal');
                
                if (placement) {
                    log('âœ… AI é…ç½®è¨ˆç®—æˆåŠŸ:', 'success');
                    log(`  åº§æ¨™: (${placement.x}, ${placement.y})`, 'success');
                    log(`  å›è»¢: ${placement.rotation}`, 'success');
                    log(`  ã‚·ã‚§ã‚¤ãƒ—: ${JSON.stringify(placement.shape)}`, 'success');
                } else {
                    log('âŒ AI é…ç½®è¨ˆç®—å¤±æ•—: null ãŒè¿”ã•ã‚Œã¾ã—ãŸ', 'error');
                }
                
            } catch (error) {
                log(`âŒ AI é…ç½®ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                log(`ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹: ${error.stack}`, 'error');
            }
        }

        function testAllPieces() {
            log('\n=== å…¨ãƒ”ãƒ¼ã‚¹é…ç½®ãƒ†ã‚¹ãƒˆ ===', 'info');
            
            try {
                const pieces = {
                    I: [[1,1,1,1]],
                    O: [[1,1],[1,1]],
                    T: [[0,1,0],[1,1,1]],
                    S: [[0,1,1],[1,1,0]],
                    Z: [[1,1,0],[0,1,1]],
                    J: [[1,0,0],[1,1,1]],
                    L: [[0,0,1],[1,1,1]]
                };
                
                const testGrid = Array(20).fill().map(() => Array(10).fill(0));
                
                Object.entries(pieces).forEach(([type, shape]) => {
                    try {
                        const placement = window.aiEngine.findBestPlacement(testGrid, shape, 'normal');
                        if (placement) {
                            log(`âœ… ${type}ãƒ”ãƒ¼ã‚¹: (${placement.x}, ${placement.y}) å›è»¢${placement.rotation}`, 'success');
                        } else {
                            log(`âŒ ${type}ãƒ”ãƒ¼ã‚¹: é…ç½®è¨ˆç®—å¤±æ•—`, 'error');
                        }
                    } catch (error) {
                        log(`âŒ ${type}ãƒ”ãƒ¼ã‚¹: ã‚¨ãƒ©ãƒ¼ - ${error.message}`, 'error');
                    }
                });
                
            } catch (error) {
                log(`âŒ å…¨ãƒ”ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        function testGameEngineAI() {
            document.getElementById('game-test-output').innerHTML = '';
            logGame('=== ã‚²ãƒ¼ãƒ ã‚¨ãƒ³ã‚¸ãƒ³ã¨AIé€£æºãƒ†ã‚¹ãƒˆ ===', 'info');
            
            try {
                if (typeof GameEngine === 'undefined') {
                    logGame('âŒ GameEngine ã‚¯ãƒ©ã‚¹ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“', 'error');
                    return;
                }
                
                const gameEngine = new GameEngine();
                logGame('âœ… ã‚²ãƒ¼ãƒ ã‚¨ãƒ³ã‚¸ãƒ³ä½œæˆæˆåŠŸ', 'success');
                
                // TETROMINOSå®šæ•°ã®ç¢ºèª
                if (typeof TETROMINOS !== 'undefined') {
                    logGame('âœ… TETROMINOS å®šæ•°å­˜åœ¨ç¢ºèª', 'success');
                    logGame(`å®šç¾©ã•ã‚Œã¦ã„ã‚‹ãƒ”ãƒ¼ã‚¹: ${Object.keys(TETROMINOS).join(', ')}`, 'info');
                } else {
                    logGame('âŒ TETROMINOS å®šæ•°ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“', 'error');
                }
                
                // AI ã‚¨ãƒ³ã‚¸ãƒ³ã¨ã®é€£æºãƒ†ã‚¹ãƒˆ
                if (window.aiEngine) {
                    logGame('âœ… AI ã‚¨ãƒ³ã‚¸ãƒ³ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½', 'success');
                    
                    // å®Ÿéš›ã®é…ç½®ãƒ†ã‚¹ãƒˆ
                    const testGrid = gameEngine.createEmptyGrid();
                    const testShape = TETROMINOS['I'].shape;
                    
                    const placement = window.aiEngine.findBestPlacement(testGrid, testShape, 'normal');
                    
                    if (placement) {
                        logGame('âœ… ã‚²ãƒ¼ãƒ ã‚¨ãƒ³ã‚¸ãƒ³çµŒç”±ã§AIé…ç½®è¨ˆç®—æˆåŠŸ', 'success');
                        logGame(`çµæœ: (${placement.x}, ${placement.y})`, 'success');
                    } else {
                        logGame('âŒ ã‚²ãƒ¼ãƒ ã‚¨ãƒ³ã‚¸ãƒ³çµŒç”±ã§AIé…ç½®è¨ˆç®—å¤±æ•—', 'error');
                    }
                } else {
                    logGame('âŒ AI ã‚¨ãƒ³ã‚¸ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã›ã‚“', 'error');
                }
                
            } catch (error) {
                logGame(`âŒ ã‚²ãƒ¼ãƒ ã‚¨ãƒ³ã‚¸ãƒ³ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                logGame(`ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹: ${error.stack}`, 'error');
            }
        }

        function simulateGamePlay() {
            logGame('\n=== ã‚²ãƒ¼ãƒ å‹•ä½œã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ ===', 'info');
            
            try {
                const gameEngine = new GameEngine();
                gameEngine.start();
                logGame('âœ… ã‚²ãƒ¼ãƒ é–‹å§‹', 'success');
                
                // ãƒ”ãƒ¼ã‚¹é¸æŠã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
                setTimeout(() => {
                    logGame('I ãƒ”ãƒ¼ã‚¹é€ä¿¡ãƒ†ã‚¹ãƒˆ...', 'info');
                    gameEngine.selectPiece('I');
                    
                    // å°‘ã—å¾…ã£ã¦ã‹ã‚‰çŠ¶æ…‹ç¢ºèª
                    setTimeout(() => {
                        logGame(`ã‚²ãƒ¼ãƒ çŠ¶æ…‹: ${JSON.stringify(gameEngine.state)}`, 'info');
                        logGame(`é€ã£ãŸãƒŸãƒæ•°: ${gameEngine.piecesSent}`, 'info');
                        logGame(`ã‚¹ã‚³ã‚¢: ${gameEngine.score}`, 'info');
                        
                        if (gameEngine.piecesSent > 0) {
                            logGame('âœ… ãƒ”ãƒ¼ã‚¹å‡¦ç†æˆåŠŸ', 'success');
                        } else {
                            logGame('âŒ ãƒ”ãƒ¼ã‚¹å‡¦ç†å¤±æ•—', 'error');
                        }
                    }, 2000);
                }, 100);
                
            } catch (error) {
                logGame(`âŒ ã‚²ãƒ¼ãƒ å‹•ä½œã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰å¾Œã®è‡ªå‹•ãƒ†ã‚¹ãƒˆ
        window.addEventListener('load', () => {
            console.log('ğŸ”§ AI ãƒ‡ãƒãƒƒã‚°ãƒ„ãƒ¼ãƒ«èª­ã¿è¾¼ã¿å®Œäº†');
            setTimeout(testAILoading, 500);
        });
    </script>
</body>
</html>